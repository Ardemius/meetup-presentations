= 2020/12/01 - Confluent : architectures Event Driven sur base de Kafka par Confluent
Thomas SCHWENDER <https://github.com/ardemius[@ardemius]>
// Handling GitHub admonition blocks icons
ifndef::env-github[:icons: font]
ifdef::env-github[]
:status:
:outfilesuffix: .adoc
:caution-caption: :fire:
:important-caption: :exclamation:
:note-caption: :paperclip:
:tip-caption: :bulb:
:warning-caption: :warning:
endif::[]
:imagesdir: images
:resourcesdir: resources
:source-highlighter: highlightjs
// Next 2 ones are to handle line breaks in some particular elements (list, footnotes, etc.)
:lb: pass:[<br> +]
:sb: pass:[<br>]
// check https://github.com/Ardemius/personal-wiki/wiki/AsciiDoctor-tips for tips on table of content in GitHub
:toc: macro
:toclevels: 2
// To turn off figure caption labels and numbers
//:figure-caption!:
// Same for examples
//:example-caption!:
// To turn off ALL captions
:caption:

toc::[]

Pr√©sentation technique des *architectures Event Driven* par *Confluent* durant la r√©union mensuelle StarTECH de d√©cembre

== Teaser

--
Pour la r√©union¬†StarTECH¬†de d√©cembre, nous accueillerons¬†Confluent¬†(https://www.confluent.fr/), qui viendra nous parler d'*architectures Event Driven*¬†(philosophie, use cases), et de comment leur stack, bas√©e sur *Kafka*, nous permet de les impl√©menter.

Depuis maintenant plusieurs ann√©es,¬†Apache Kafka¬†r√®gne en ma√Ætre dans la cat√©gorie des¬†messages brokers, √† laquelle appartiennent √©galement ActiveMQ et RabbitMQ. +
Cela est d'autant plus vrai dans le monde de la Data, du fait de ses excellentes performances en termes de v√©locit√©. +
Confluent a d√©velopp√© tout un √©cosyst√®me autour de ce dernier (Kafka Connect, Kafka Streams, Schema Registry, etc.) afin d'en √©tendre le scope et les usages. +
Cette stack est de plus en plus utilis√©e, en conna√Ætre les briques et le fonctionnement est un vrai plus, et sera d'ici peu une obligation (si ce n'est pas d√©j√† le cas üòâ)

La pr√©sentation aura lieu le¬†mardi 01/12, de¬†19h √† 20h30¬†(cr√©neau habituel de r√©union de la communaut√© StarTECH).

Nous aurons la chance de recevoir 3 experts Confluent pour nous en parler :¬†Florent RAMIERE,¬†Olivier LAPLACE¬†et¬†R√©mi FOREST. +
Les contributeurs StarTECH doivent se souvenir de R√©mi, qui √©tait venu nous pr√©senter mi-2018 la distro Hadoop MapR (√©diteur chez qui il travaillait √† l'√©poque). +
Apr√®s une 1ere partie th√©orique, nous encha√Ænerons sur une d√©mo, suivie d'une s√©ance de questions / r√©ponses.

De nouveau, c'est une belle occasion de faire sa veille techno directement avec l'√©diteur, donc VENEZ NOMBREUX ! üòÉ
--

== Draft notes

* Eric ORTIZ: 2 ans chez Confluent, Partners Manager SEMEA
* Olivier LAPLACE : architecte avant-vente chez Confluent, va nous faire la prez
* Florent RAMIERE : architecte, r√©pondra aux questions du chat
* R√©mi FOREST : manage les pr√©-sales c√¥t√© SEMEA

2 d√©mos de pr√©vues : Confluent platform et Concluent Cloud

Titre du talk par Confluent : *Event Driven 101 & Demo*

IMPORTANT: De nos jours, l'importance est donn√©e aux *donn√©es fra√Æches*, √† l'*imm√©diatet√©*.

Plan du talk :

	* Event
	* Event Driven
	* Event Driven architecture
	* Evens streaming plateforme
	* Points d'attention
	* Demo CP & CC

* *Events vs State* : analogie √† une partie d'√©checs, s√©quence de coups jou√©s (events) vs √©tat "simple" de la partie √† l'instant "t" (state)
* Gartner : en 2020 80% des besoins digitaux seront trait√©s en event driven avec pour cible le temps r√©el

Real time with historical context : Contextual

	* Event-Driven App : pizza achet√© le 15/10
	* CONTEXTUAL Event-Driven App : vous avez achet√© 2 pizzas la journ√©e du 15/10. 2 pizza ?! Est-ce normal ?
		** permet donc la d√©tection de *comportements anormaux*

image::20201201_startech_confluent-kafka_01.png[]

Kafka, quels int√©r√™ts :

	* lets you publish and subscribe to events
	* lets you store events for as long as you want
	* let your process and analyse events

Kafka facilite le *d√©couplage des technos*.

.Anatomy of a Kafka Topic
image:20201201_startech_confluent-kafka_02.png[]

.Rappels rapides sur Kafka lui-m√™me
[NOTE]
====

	* notion de Producteur -> Topic -> Partition -> Consumer dans Kafka
		** garantie de l'ordre par partition
	* Kafka : *commit log*, *immutable*, *append-only*
====

.Push vs Pull queries
image:20201201_startech_confluent-kafka_03.png[]

.Kafka + Kafka Connect + Kafka Streams
image:20201201_startech_confluent-kafka_04.png[]

.La plateforme Confluent
image:20201201_startech_confluent-kafka_05.png[]

* Confluent (pas Kafka, Confluent) comme un *backbone d'√©v√®nements*, le syst√®me nerveux de transfert d'√©v√®nements
	** passer du spaghetti aux lasagnes -> ce que permet ce backbone unifi√©

.Confluent platform 6.0
image:20201201_startech_confluent-kafka_06.png[]

.Quelles sont les questions qui font sens pour passer sur √† une *architecture Event Driven* ?
image:20201201_startech_confluent-kafka_07.png[]

.Est-ce facile de passer √† ce type d'architecture ?
image:20201201_startech_confluent-kafka_08.png[]

-> Pas si simple que cela, comme pour tout *syst√®me distribu√©* au final.

* Mise en place de la gouvernance d√®s le d√©but du projet : bien penser au *Schema Registry*

.Ressource conseill√©e : _Designing Event-Driven Systems_ de Ben Stopford (ancien de Confluent ?)
image:20201201_startech_confluent-kafka_09.png[width=600]

=== DEMO

image:20201201_startech_confluent-kafka_10.png[]
image:20201201_startech_confluent-kafka_11.png[]

* Florent nous conseille de regarder https://github.com/confluentinc/cp-demo/ pour une d√©mo de la plateforme. 
	** et de regarder le docker-compose.yml
	** TOUTE la s√©curit√© a √©t√© sett√©e cf Florent

image::20201201_startech_confluent-kafka_12.png[]

* d√©veloppement d'un *petit canon √† Tweets* pour les besoins de la d√©mo
	** pour le code voir https://www.confluent.io/hub/jcustenborder/kafka-connect-twitter

* Florent : *KSQLDB* est une *surcouche de Kafka Stream*
	** si vous n'arrivez pas a exprimer votre m√©tier dans ksqldb, *il ne faut pas hesiter a utiliser un outil de plus bas niveau* ... en l'occurence kafka Streams

* de multiples connecteurs disponibles : 
	** Snowflake pour de l'analytics
	** Couchbase pour du In Memory
	** MongoDB

Florent : Au final, cette d√©mo :

	* choper de la data en live
	* la transformer en live
	* la d√©piler en live dans ES
	* le tout dans un seul d√©ploiement

Voir https://github.com/confluentinc/demo-scene

* Florent : vous voulez d√©couvrir chacun des composants ... mais sans pourrir tout votre setup, je vous conseille : +
https://github.com/vdesabou/kafka-docker-playground/
	** c'est un coll√®gue de Florent

=== Chat

[NOTE]
====
Le chat a √©t√© tr√®s actif, et on y a tap√© √† toute vitesse... +
Ne pr√™tez donc attention ni style ni aux fautes üòÅüòÖ
====

* diff√©rences entre Kafka et RabbitMQ / ActiveMQ
	** Florent : en somme, rabbit est un excellent pub/sub, kafka est une plateforme de streaming

* Alessandro pose une question sur le max de partitions
	** Florent : bon, en gros il y a 2 r√®gles : pas plus de 5000 partitions par broker, et moins de 200 000 partition par cluster

* Florent : ajouter un element dans un consumer group pour aller plus vite, ne demande AUCUNE config. +
c'est natif¬†a kafka, ca s'appelle le consumer group protocol +
en revanche, le vecteur de scalabilit√© est li√© au nombre de partitions

* Florent : ouaip, agr√©ger les logs dans kafka c'est un super cas d'usage pour d√©buter +
j'ai commenc√© kafka chez BNP en faisant ca +
J'avais plus de 4To compress√© avec un cluster ES d'un PETA (la mis√®re) +
grosso modo, ca permet de g√©rer la *back pressure* +
-> sans kafka cela aurait explos√©

* Florent : √† l'arrache, tu vas sortir les donn√©es de Kafka quasi √† la vitesse de ton r√©seau

* tiens, concernant le KSQL, il se situe comment par rapport au SQL ANSI ?
	** Florent : 
+
----
good question
non c'est PAS du sql
ksqldb n'est PAS une base de donn√©es
c'est pour processer au fil de l'eau les √©v√®nements
l'usage du dsl sql est pour l'utilisabilit√©
si t'as besoin de trucs plus riches --> utilise une vraie base¬†
----

* Florent : sur le terrain, si on enl√®ve le marketing, on fait des choses souvent tr√®s simples +
3 joins, 2 aggregate, et un 1 agr√©gat temporel, et t'es d√©j√† MEGA HYPER avanc√© :)

* Florent : Le clien confluent .Net est moins riche que celui de java (surtout sur le K-streams) les aggregations sont possibles avec le client java mais pas le client .Net

* Florent : pour ksql, j'ai l'habitude de dire, si c'est trivial, et que t'as test√© et que t'as pas gal√©r√© 3h, c'est good. +
Sinon c'est Kafka Streams 
+
IMPORTANT: on fera probablement jamais le port de Kafka Stream sur .Net, ni sur python, ni sur Go, ni sur C++, etc etc.

* quel est le meilleur moyen pour tester le fonctionnement/perfs de kafka?
	** Florent : kafka-producer-perf.sh et kafka-consumer-perf.sh, c'est dans la distribution
		*** voir https://gist.github.com/framiere/b64d3a1897f764128793e1de20950742

* Florent : il y a des certifications "officielles" sur Kafka Confluent : https://www.confluent.io/certification/

* Pour "apprendre Kafka" : voir https://developer.confluent.io/

* FLorent : NE LAISSEZ JAMAIS PARTIR VOS CLIENTS EN PROD SANS SUPERVISION BO***EL!
	** Control Center est l'interface de supervision
	** *compression native dans le protocol !* -> UTILISEZ LA
		*** moins de r√©seau pour envoyer, moins de stockage, moins de r√©seau pour r√©pliquer, moins de r√©seau pour consommer

* Florent : on peut avoir un cluster on premise, et un cluster dans le cloud, et les faire communiquer

=== S√©ance de questions / r√©ponses

* Voir le Chat !

* Pourrons-nous avoir les slides de la pr√©sentation ?

== ROTI du talk

Pouvez-vous donner votre retour sur cette pr√©sentation ?

5. Excellente : √áa valait bien plus que le temps qu'on y a pass√©
4. Bonne : J'ai gagn√© plus que le temps que j'y ai pass√©
3. Juste Moyenne : Je n'ai pas perdu mon temps, sans plus
2. Utile mais... :  √ßa ne valait pas √† 100% le temps que j'y ai pass√©
1. Inutile : Je n'ai rien gagn√©, rien appris

image::20201201_startech_confluent-kafka_14.png[]

-> ROTI tr√®s positif ! Minimum 4, moyenne 4.6 üëç

== Ressources

* Video du talk sur notre cha√Æne YouTube : https://www.youtube.com/watch?v=uqKG9qQpA4w&list=PLbd6jztIXBjn-_ZY53Id6zOiO3uJ-8IQu

Ressources par Confluent :

image::20201201_startech_confluent-kafka_13.png[]

* https://developer.confluent.io/ pour toutes les ressources techniques
* https://www.confluent.io/blog/ pour le blog, tr√®s fourni, de Confluent
* livre _Designing Event-Driven Systems_ de Ben Stopford

