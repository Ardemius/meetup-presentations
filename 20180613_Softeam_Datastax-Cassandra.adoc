= 12@13 : DataStax Cassandra
Thomas SCHWENDER <https://github.com/ardemius[@ardemius]>
// Handling GitHub admonition blocks icons
ifndef::env-github[:icons: font]
ifdef::env-github[]
:status:
:outfilesuffix: .adoc
:caution-caption: :fire:
:important-caption: :exclamation:
:note-caption: :paperclip:
:tip-caption: :bulb:
:warning-caption: :warning:
endif::[]
:imagesdir: images
:source-highlighter: highlightjs
// Next 2 ones are to handle line breaks in some particular elements (list, footnotes, etc.)
:lb: pass:[<br> +]
:sb: pass:[<br>]
// check https://github.com/Ardemius/personal-wiki/wiki/AsciiDoctor-tips for tips on table of content in GitHub
:toc: macro
//:toclevels: 3
// To turn off figure caption labels and numbers
:figure-caption!:

toc::[]

Pr√©sent√© par *l'√©quipe DataStax France* : *Julien MICHEL*, Solution Engineer (julien.michel@datastax.com), et *J√©r√¥me RUIZ* Regional Channel Director (jerome.ruiz@datastax.com)

// Julien tel : 07 87 03 02 44

== Abstract

====
Avez-vous toujours eu envie d'approfondir vos connaissances Big Data ?

Venez √† notre deuxi√®me 12@13 de la s√©rie sur le NoSQL, ce nouveau type de base de donn√©es adapt√©es aux probl√©matiques Big Data !

Nous recevons l'√©quipe de DataStax, qui nous fera une vue d'ensemble de Cassandra (base NoSQL de type colonne) et de DSE, la solution enterprise qui int√®gre Cassandra aux frameworks Spark (Analytics), SOLR (Search) et TinkerPop (Graph).

Et si vous voulez aller plus loin, rejoignez l'initiative Big Data - Datastax chez Softeam, venez le 13 juin pour plus d'informations !
====


Etait offert durant le MeetUp l'√©dition de poche _"Designing a Distributed Cloud Database for dummies"_

image::20180613_datastax-cassandra_10.jpg[width=200]


== Notes

.The New Database Market
image::20180613_datastax-cassandra_01.jpg[]

.The DSE (DataStax Enterprise) platform
image::20180613_datastax-cassandra_02.jpg[]

* Suite √† un rachat Cassandra g√®re maintenant les *graphes*
* Cassandra impose un certain mod√®le de donn√©es

//-

* Le principal *rival* de DataStax Cassandra est *Cassandra OpenSource*

Qui utilise d√©j√† Cassandra ?

* *Apple* pour les notions de *scalibilit√©* de la plateforme
* *Netflix* pour les qualit√©s de *r√©silience* (*Chaos Monkey*)
* *Spotify* pour la *BDD distribu√©e* (facteur de r√©plication) et le *zero data loss*

*Cassandra Use Cases*

* MDM
* IoT and Time Series
* Personalization and Recommendation
* Fraud Detection
* List Management
* Messaging
* Inventory Management
* Authentication / Sessions -> exemple, le PlayStation Network

image::20180613_datastax-cassandra_03.jpg[]

=== Apache Cassandra characteristics

image::20180613_datastax-cassandra_04.jpg[]

* Cassandra a √©t√© cr√©√© en s'inspirant de *Google Big Table* (distributed) et *Amazon Dynamo* (master-less)
* est *faite pour perdre des noeuds*

Les 2 principaux crit√®res pour *estimer le nombre de noeuds √† avoir dans son cluster* :

* Nombre de requ√™tes / sec
* volume de donn√©es

-> Voir le https://medium.com/netflix-techblog/benchmarking-cassandra-scalability-on-aws-over-a-million-writes-per-second-39f45f066c9e[benchmark de Netflix]

image::https://cdn-images-1.medium.com/max/1400/1*r2pJJZxKNktYmRN5mi5tOA.png[width=500]

Apache Cassandra :

* est *master-less* (contrairement √† MongoDB par exemple, qui est *master / slave*)
* *read/write to any node* : tous les noeuds sont identiques, et peuvent accepter lecture et √©criture
* configurable Data Replication 
* Pr√©co par d√©faut de Cassandra : *facteur de r√©plication de 3*
* Cassandra est multi-DC (Data Center) : *active-active* avec *geo-replication*

.Gestion du multi-DC
image::20180613_datastax-cassandra_05.jpg[]

-> Pour info, si on active l'analytics sur un noeud, il faut l'activer sur tous les noeuds du DC.

*Consistence dans Cassandra*

* [red]*Eventually Consistent* (et non strongly consistent)
+
NOTE: Pour une bonne comparaison d'Eventually Consistent vs Strongly Consistent, voir https://hackernoon.com/eventual-vs-strong-consistency-in-distributed-databases-282fdad37cf7[ce post du blog de Hackernoon].

* *3 niveaux de coh√©rence* :
	** *ONE* : j'attends d'uniquement 1 noeud
	** *QUORUM* : j'attends *la majorit√©* des noeuds 
	** *ALL* : je dois avoir la r√©ponse de *tous les noeuds*

+
-> Les niveaux de coh√©rence se configurent en lecture *ET* en √©criture.

.Write ONE, read ALL
image::20180613_datastax-cassandra_06.jpg[]

image::20180613_datastax-cassandra_07.jpg[]

Les mod√®les de coh√©rence les plus fr√©quents :

* ONE Read + One Write
* QUORUM Read + QUORUM Write

*Langage de requ√™tage* : Cassandra Query Language (CQL)

* pas un langage relationnel (Cassandra n'est *PAS* une base relationnelle)
* pas de proc stock

.Cassandra : BDD NoSQL de type Wide Column Stores
[NOTE]
====
Cassandra est une base NoSQL de type _"Wide Column Stores"_. +
Pour des d√©tais pr√©cis, je vous conseille d'aller regarder https://db-engines.com/en/article/Wide+Column+Stores[la d√©finition sur l'excellent site DB-engines].

Pour r√©sumer simplement les choses : Dans Cassandra, *les colonnes sont persist√©es en fonction d'une cl√© de partition*. +
On pourrait le voir comme un hybride entre une base orient√©e colonne et un key-value store.
====

image::20180613_datastax-cassandra_08.jpg[]

=== DataStax platform

* *DSE* = DataStax Enterprise, la plateforme unifi√©e de DataStax.
* Plateforme *unifi√©e* pour graphe, batch analytics, indexing & search, streaming analytics

WARNING: Cassandra n'a pas pour vocation de concurrencer tous les types de BDD (Cassandra ne concurrence pas Hadoop par exemple)

* DataStax *OpsCenter*
	** Visual, browser-based user interface
	** Secure role based access control
	** Version 6 : ajout du *NodeSync* +
	-> fait que *le repair devient inutile* dans 99% des cas

NOTE: Preco de base Cassandra : *1 To / noeud* +
Principalement pour √©viter le streaming d'un trop gros volume de data lors de la chute d'un noeud et du bootstrap d'un nouveau

Evidemment, pr√©sence d'un *support* :

* 24x7x365
* PROD et *NON*-PROD env

* *DSE Advanced Replication*
	** allows one-way replication from ed 

* *DSE Tiered Storage*
	** preco Cassandra : utiliser au max des SSD, mais peut devenir cher pour un gros volume de donn√©es
	** d'o√π l'ajout du Tiered Storage qui permet de d√©placer les data anciennes sur un support moins on√©reux
	** Les SAN sont tr√®s fortement d√©conseill√©s par Cassandra, car va ajouter un Single Point of Failure (pour un syst√®me distribu√©, c'est dommage)

* *DSE Enterprise Security*
	** *Transparent Data Encryption* of ALL DSE at rest +
	-> *baisse de performance de l'ordre de ~10%* (l'encryption co√ªte de moins en moins en perf avec l'am√©lioration des micro-processeurs)
	** Unified authentication : Kerberos / AD, mais *PAS d'OAuth2* üò≠

* *DSE Search*
	** se base sur Solr

* *DSE Analytics*
	** Embedded Apache Spark
	** Distributed FS (DSEFS), compatible avec HDFS, mais *sans Name Node* +
	-> Permet d'avoir les donn√©es d'archive dessus (√©conomie de co√ªt)

* *DSE Graph*
	** inspir√© sur TitanDB graph database
	** build on Apache Tinkerpop graph framework (graph -> ce qui va se rapprocher le plus d'une BDD relationnelle)
	** utilise le langage Gremlin
	** Cas d'usage les plus fr√©quents : la d√©tection de fraudes (ex : les Panama papers)

.DSE technology stack
image::20180613_datastax-cassandra_09.jpg[]

== Conclusion & synth√®se

On a vu que DataStax mettait tr√®s en avant sa *plateforme unifi√©e*, comme beaucoup d'autres √©diteurs en ce moment (Kafka, ActivePivot, MapR, etc.).

Celle-ci comporte maintenant de nombreuses fonctionnalit√©s gravitant autour de la BDD "historique" Apache Cassandra (DSE Search, DSE Analytics, etc.) +
N√©anmoins, Julien et J√©r√¥me ont indiqu√© que ces fonctionnalit√©s n'avaient PAS pour vocation de placer DSE comme un remplacement aux produits historiquement d√©velopp√©s pour ces domaines (Elasticsearch pour l'indexation, Hadoop pour l'analytics, etc.)

Donc, *dans quels cas les utiliser* ? Voici leur r√©ponse :

* A la base on utilise Cassandra pour avoir *une base qui scale*
* Cette base permet d'avoir sur un m√™me noeud la gestion du Temps R√©el ET de l'archivage
* La plateforme DSE repr√©sente une solution √† *moindre co√ªt*, o√π l'on peut faire un peu de tout, et qui *√©vite la grande complexit√© de la maintenance d'une stack Hadoop on-premise*.
+
NOTE: Ce constat comme quoi la stack Hadoop est diffice √† maintenir est un pain point que l'on retrouve *partout* en ce moment.
* Par contre, la cible de DSE n'est pas les grands comptes (qui peuvent eux se payer une √©quipe d'OPS administrant une stack on-premise compliqu√©e), mais les "moyens" comptes. 
+
NOTE: J'avoue √™tre un peu surpris de cette communication, m√™me si j'en comprends les raisons. +
La complexit√© des stacks data est une des grandes pr√©occupations du moment, et l'on sent bien que de nombreux √©diteurs cherchent √† en profiter, en proposant une solution "tout-en-un" plus simple √† maintenir.

TIP: Pour des ressources sur Cassandra, jetez √† oeil √† la https://academy.datastax.com/[DataStax Academy] qui propose plusieurs cours en ligne.

== Q&A

* Pas la notion de transaction au sens ACID dans Cassandra, mais existence d'une notion de "light transaction" +
Par contre, cela a un co√ªt en termes de performance.






